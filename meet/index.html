<!DOCTYPE html>
<html>
<head>
  <title>Jitsi Meeting</title>
</head>
<body>
  <h2>Enter Your Name</h2>
  <input id="name" placeholder="Your name" />
  <br><br>
  <button onclick="startMeeting()">Join Meeting</button>

  <div id="jitsi-container" style="height: 700px; width: 100%; margin-top: 20px;"></div>

  <script src="https://8x8.vc/external_api.js"></script>
  <script>
    async function startMeeting() {
      const name = document.getElementById('name').value;
      const isModerator = name.toLowerCase().includes('admin');

      const res = await fetch('https://jaas-token-server.onrender.com/token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, isModerator })
      });

      const data = await res.json();

      const domain = '8x8.vc';
      const options = {
        roomName: 'MyCustomMeetingRoom001', // Customize your room name
        parentNode: document.getElementById('jitsi-container'),
        jwt: data.token
      };

      const api = new JitsiMeetExternalAPI(domain, options);

      if (isModerator) {
        api.addEventListener('videoConferenceJoined', () => {
          api.executeCommand('toggleLobby', true);
        });
      }
    }
  </script>
</body>
</html>
